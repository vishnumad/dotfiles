# i3 Stuff {{{

# -----------------------------------------------------------------------------
# Mod Key (Mod4: Super, Mod1: Alt)
set $mod Mod4

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# -----------------------------------------------------------------------------
# Mouse Focus (Default: yes)
focus_follows_mouse yes


# -----------------------------------------------------------------------------
# Borders & Gaps

set $border_size 2
set $gap_size 10

for_window [class=.*] border pixel $border_size
smart_borders on

# Gaps
gaps inner $gap_size
smart_gaps on


# -----------------------------------------------------------------------------
# Font
font pango:Roboto 11
for_window [class=".*"] title_format " %title "
title_align center

# -----------------------------------------------------------------------------
# Workspace Names

# Define names for default workspaces for which we configure key bindings later on.
# We use variables to avoid repeating the names in multiple places.
set $ws1  "1"
set $ws2  "2"
set $ws3  "3"
set $ws4  "4"
set $ws5  "5"
set $ws6  "6"
set $ws7  "7"
set $ws8  "8"
set $ws9  "9"
set $ws10 "10"

# }}}

# i3 Keybindings {{{

# kill focused window
bindsym $mod+Shift+q kill

# reload the configuration file
bindsym $mod+Shift+c reload
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart
# exit i3 (logs you out of your X session)
bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'Do you want to exit i3?' -B 'Yes, exit i3' 'i3-msg exit'"

# change focus
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

# move focused window
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right

# split in horizontal orientation
bindsym $mod+n split h
# split in vertical orientation
bindsym $mod+v split v

# enter fullscreen mode for the focused container
bindsym $mod+f fullscreen toggle

# change container layout (stacked, tabbed, toggle split)
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# change focus between tiling / floating windows
bindsym $mod+Mod1+space focus mode_toggle

# focus the parent container
bindsym $mod+a focus parent

# focus the child container
bindsym $mod+d focus child

# switch to workspace
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5
bindsym $mod+6 workspace $ws6
bindsym $mod+7 workspace $ws7
bindsym $mod+8 workspace $ws8
bindsym $mod+9 workspace $ws9
bindsym $mod+0 workspace $ws10

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5
bindsym $mod+Shift+6 move container to workspace $ws6
bindsym $mod+Shift+7 move container to workspace $ws7
bindsym $mod+Shift+8 move container to workspace $ws8
bindsym $mod+Shift+9 move container to workspace $ws9
bindsym $mod+Shift+0 move container to workspace $ws10

# Resize quick shortcuts
bindsym $mod+Shift+Right resize grow   width  10 px or 1 ppt
bindsym $mod+Shift+Left  resize shrink width  10 px or 1 ppt
bindsym $mod+Shift+Up    resize grow   height 10 px or 1 ppt
bindsym $mod+Shift+Down  resize shrink height 10 px or 1 ppt

# Scratchpad
bindsym $mod+Shift+minus move scratchpad
bindsym $mod+minus scratchpad show

# Toggle gaps (https://www.reddit.com/r/i3wm/comments/5qyspk)
bindsym $mod+g exec --no-startup-id "if [ $(i3-msg -t get_tree | jq -r \
    'recurse(.nodes[]) | if .type == \\"workspace\\" and .name == \\"'`i3-msg \
    -t get_workspaces | jq -r '.[] | if .[\\"focused\\"] then .[\\"name\\"] else \
    empty end'`'\\" then .gaps.inner else empty end') -eq 0 ]; \
    then \
        i3-msg gaps inner current set 0; \
    else \
        i3-msg gaps inner current set $gap_size; fi"

# }}}

# Colors {{{

# Focused colors
set $f_border     "#69748d"
set $f_indicator  "#acb2c1"
set $fi_bg        "#292c37"

# Unfocused colors
set $uf_border    "#292c37"
set $uf_indicator "#292c37"

# Title text color
set $f_text       "#f2f2f5"
set $f_text_h     "#f2f2f5"
set $uf_text      "#5c627b"

#<colorclass>           <border>    <background> <text>    <indicator>   <child_border>
client.focused          $f_border   $f_border    $f_text_h $f_indicator  $f_border
client.focused_inactive $uf_border  $fi_bg       $f_text   $uf_indicator $uf_border
client.unfocused        $uf_border  $uf_border   $uf_text  $uf_indicator $uf_border
client.urgent           $f_border   $uf_border   $f_text   $f_indicator  $uf_border

# }}}

# Custom Keybindings {{{

# Default terminal
bindsym $mod+Return exec konsole

# Application runner
bindsym $mod+space exec --no-startup-id rofi -show drun
bindsym Mod1+space exec --no-startup-id rofi -show

# }}}

# Startup Applications {{{

# Set wallpaper
exec_always --no-startup-id sleep 3; nitrogen --restore

# Compositor
exec --no-startup-id compton &

# }}}

# Plasma Integration {{{

# Try to kill the wallpaper set by Plasma (it takes up the entire workspace and
# hides everything)
exec --no-startup-id wmctrl -c Plasma
for_window [title="Desktop â€” Plasma"] kill, floating enable, border none

# Kill krunner on startup
exec_always --no-startup-id killall krunner

# Avoid tiling popups, dropdown windows from plasma
for_window [class="plasmashell"] floating enable, border none, move up 2 px
for_window [class="Plasma"] floating enable, border none
for_window [class="plasmashell" title="plasma-desktop"] floating enable, border none
for_window [class="Klipper"] floating enable
for_window [class="Plasmoidviewer"] floating enable, border none

# }}}

# Window Rules {{{

# Avoid tiling for non-Plasma stuff
for_window [window_role="pop-up"] floating enable
for_window [window_role="bubble"] floating enable
for_window [window_role="task_dialog"] floating enable
for_window [window_role="Preferences"] floating enable
for_window [window_role="About"] floating enable
for_window [window_type="dialog"] floating enable
for_window [window_type="menu"] floating enable
for_window [class="Nitrogen"] floating enable
# Telegram media viewer popup
for_window [class="Telegram" title="Media viewer"] floating enable, border none, move position 0 px 0 px
#for_window [instance="__scratchpad"] floating enable

# Prevent notifications and plasma shell popups from stealing focus
no_focus [class="plasmashell"]

# Resize telegram to take up 20% of screen width
for_window [tiling class="Telegram"] resize set width 20 ppt

# }}}
